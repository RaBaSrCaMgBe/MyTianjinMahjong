<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="screen.css">
<title>客户端测试</title>
</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg" 
xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
<script src="modules/tools.js"></script>
<script>
    // svg命名空间
    const xmlns="http://www.w3.org/2000/svg";

    // 获取屏幕尺寸 计算画布尺寸
    const h = 750;
    const w = h * 667 / 375

    // 设置svg尺寸
    const svg = document.querySelector("svg");
    svg.setAttributeNS(null, "width", w);
    svg.setAttributeNS(null, "height", h);

    // 牌的尺寸
    const tileWidth = h / 17.25;
    const tileHeight = tileWidth * 35 / 31
    const tileWidthHand = tileWidth * 1.5
    const tileHeightHand = tileHeight * 1.5

    // 绘制中间面板
    const middleFrameX = w / 2 - tileWidth * 3;
    const middleFrameY = tileHeight + (h - tileHeight * 2.5- tileWidth * 6) / 2;
    tmp = document.createElementNS(xmlns, "rect");
    tmp.setAttributeNS(null, "x", middleFrameX);
    tmp.setAttributeNS(null, "y", middleFrameY);
    tmp.setAttributeNS(null, "width", tileWidth * 6);
    tmp.setAttributeNS(null, "height", tileWidth * 6);
    tmp.setAttributeNS(null, "fill", "gray");
    svg.appendChild(tmp);

    // 绘制自家手牌区
    let imageURL = "assets/1m.jpg";
    let selfHandStartX = tileHeight + 30;
    let selfHandStartY = h - tileHeightHand;
    let selfCurX = selfHandStartX
    for (let i = 0; i < 13; i++) {
        tmp = document.createElementNS(xmlns, "image");
        tmp.setAttribute("href", imageURL);
        tmp.setAttributeNS(null, "x", selfCurX);
        tmp.setAttributeNS(null, "y", selfHandStartY);
        tmp.setAttributeNS(null, "width", tileWidthHand);
        tmp.setAttributeNS(null, "height", tileHeightHand);
        svg.appendChild(tmp);
        selfCurX += tileWidthHand;
    }
    // 绘制自家摸牌
    tmp = document.createElementNS(xmlns, "image");
    tmp.setAttribute("href", imageURL);
    tmp.setAttributeNS(null, "x", selfCurX + tileWidthHand * 0.25);
    tmp.setAttributeNS(null, "y", selfHandStartY);
    tmp.setAttributeNS(null, "width", tileWidthHand);
    tmp.setAttributeNS(null, "height", tileHeightHand);
    svg.appendChild(tmp);

    // 绘制下家副露区
    let rightFuluAreaX = w - tileHeight;
    let rightFuluAreaY = tileWidth * 0.25;
    let rightCurY = rightFuluAreaY;
    for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {
            tmp = document.createElementNS(xmlns, "image");
            tmp.setAttribute("href", imageURL);
            tmp.setAttributeNS(null, "x", rightFuluAreaX + (tileHeight - tileWidth) / 2);
            tmp.setAttributeNS(null, "y", rightCurY + (tileWidth - tileHeight) / 2);
            tmp.setAttributeNS(null, "width", tileWidth);
            tmp.setAttributeNS(null, "height", tileHeight);
            tmp.setAttributeNS(null, "transform", `rotate(-90,${rightFuluAreaX + tileHeight / 2}, ${rightCurY + tileWidth / 2})`);
            svg.appendChild(tmp);
            rightCurY += tileWidth;
        }
        rightCurY += tileWidth * 0.25; 
    }

    // 绘制对家副露区
    let oppositeFuluAreaX = w / 2 - tileWidth * 8.5;
    let oppositeFuluAreaY = 0;
    let oppositeCurX = oppositeFuluAreaX;
    for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {
            tmp = document.createElementNS(xmlns, "image");
            tmp.setAttribute("href", imageURL);
            tmp.setAttributeNS(null, "x", oppositeCurX);
            tmp.setAttributeNS(null, "y", oppositeFuluAreaY);
            tmp.setAttributeNS(null, "width", tileWidth);
            tmp.setAttributeNS(null, "height", tileHeight);
            tmp.setAttributeNS(null, "transform", `rotate(180,${oppositeCurX + tileWidth / 2}, ${oppositeFuluAreaY + tileHeight / 2})`);
            svg.appendChild(tmp);
            oppositeCurX += tileWidth;
        }
        oppositeCurX += tileWidth * 0.25; 
    }

    // 绘制上家副露区
    let leftFuluAreaX = 0;
    let leftFuluAreaY = h - tileWidth * 1.25;
    let leftCurY = leftFuluAreaY;
    for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {
            tmp = document.createElementNS(xmlns, "image");
            tmp.setAttribute("href", imageURL);
            tmp.setAttributeNS(null, "x", leftFuluAreaX + (tileHeight - tileWidth) / 2);
            tmp.setAttributeNS(null, "y", leftCurY + (tileWidth - tileHeight) / 2);
            tmp.setAttributeNS(null, "width", tileWidth);
            tmp.setAttributeNS(null, "height", tileHeight);
            tmp.setAttributeNS(null, "transform", `rotate(90,${leftFuluAreaX + tileHeight / 2}, ${leftCurY + tileWidth / 2})`);
            svg.appendChild(tmp);
            leftCurY -= tileWidth;
        }
        leftCurY -= tileWidth * 0.25; 
    }

    // 绘制id
    let selfID = "player1";
    let selfPosition = 0;
    let playerID = ["player1", "player2", "player3", "player4"];
    let playerScore = [3044, 20, 0, 0];
    // 绘制自家
    let tmpX = tileHeight + 35;
    let tmpY = h - tileHeightHand;
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerID[selfPosition];
    tmp.setAttributeNS(null, "x", tmpX);
    tmp.setAttributeNS(null, "y", tmpY - 40);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    // 绘制下家
    tmpX = w - tileHeight - 40;
    tmpY = h - tileHeightHand - 20;
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerID[(selfPosition + 1) % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    let box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", tmpX + 20 - box / 2);
    tmp.setAttributeNS(null, "y", tmpY - box / 2 - 20);
    tmp.setAttributeNS(null, "transform", `rotate(-90,${tmpX + 20}, ${tmpY - box / 2})`);
    // 绘制对家
    tmpX = w - tileHeight - 40;
    tmpY = tileHeight;
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerID[(selfPosition + 2) % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", tmpX - box);
    tmp.setAttributeNS(null, "y", tmpY);
    tmp.setAttributeNS(null, "transform", `rotate(180,${tmpX - box / 2}, ${tmpY + 20})`);
    // 绘制上家
    tmpX = tileHeight;
    tmpY = tileHeight + 20;
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerID[(selfPosition + 3) % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", tmpX + 20 - box / 2);
    tmp.setAttributeNS(null, "y", tmpY + box / 2 - 20);
    tmp.setAttributeNS(null, "transform", `rotate(90,${tmpX + 20}, ${tmpY + box / 2})`);
    
    // 绘制分数
    // 绘制自家
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerScore[selfPosition % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + tileWidth * 6 - 20);
    // 绘制下家
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerScore[(selfPosition + 1) % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", middleFrameX + tileWidth * 6 - 10 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + tileWidth * 3 - 10);
    tmp.setAttributeNS(null, "transform", `rotate(-90,${middleFrameX + tileWidth * 6 - 10}, ${middleFrameY + tileWidth * 3})`);
    // 绘制对家
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerScore[(selfPosition + 2) % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY);
    tmp.setAttributeNS(null, "transform", `rotate(180,${w / 2}, ${middleFrameY + 10})`);
    // 绘制上家
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = playerScore[(selfPosition + 3) % 4];
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", middleFrameX + 10 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + tileWidth * 3 - 10);
    tmp.setAttributeNS(null, "transform", `rotate(90,${middleFrameX + 10}, ${middleFrameY + tileWidth * 3})`);
    
    // 绘制场次
    let dealer_pos = 2;
    let match_no = 0;
    let tmpctx = "";
    tmp = document.createElementNS(xmlns, "text");
    if (match_no == 0) {
        tmpctx += "东";
    }
    else {
        tmpctx += "南";
    }
    if (dealer_pos == 0) {
        tmpctx += "一局";
    }
    else if (dealer_pos == 1) {
        tmpctx += "二局";
    }
    else if (dealer_pos == 2) {
        tmpctx += "三局";
    }
    else {
        tmpctx += "四局";
    }
    tmp.textContent = tmpctx;
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "30");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + tileWidth * 2);

    // 绘制混儿文字提示
    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = "混儿指示牌为:";
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "20");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + tileWidth * 3);
    // 绘制混儿牌图片
    tmp = document.createElementNS(xmlns, "image");
    tmp.setAttribute("href", imageURL);
    tmp.setAttributeNS(null, "x", w / 2 - tileWidth / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + tileWidth * 3.5);
    tmp.setAttributeNS(null, "width", tileWidth);
    tmp.setAttributeNS(null, "height", tileHeight);
    svg.appendChild(tmp);
    

    let optionAreaStartX = w - tileHeight - 100 - tileWidthHand * 2;
    let optionAreaStartY = h - tileHeightHand * 2 - 20;
    let optionNo = 0;
    let tmpx = optionAreaStartX;
    let tmpy = optionAreaStartY;
    for (let i = 0; i < 4; i++) {
        tmp = document.createElementNS(xmlns, "rect");
        tmp.setAttributeNS(null, "x", tmpx);
        tmp.setAttributeNS(null, "y", tmpy);
        tmp.setAttributeNS(null, "width", tileWidthHand * 2);
        tmp.setAttributeNS(null, "height", tileHeightHand);
        tmp.setAttributeNS(null, "fill", "gray");
        svg.appendChild(tmp);

        tmp = document.createElementNS(xmlns, "text");
        tmp.textContent = "和牌";
        tmp.setAttributeNS(null, "x", 0);
        tmp.setAttributeNS(null, "y", 0);
        tmp.setAttributeNS(null, "font-size", "40");
        svg.appendChild(tmp);
        boxw = tmp.getBBox().width;
        boxh = tmp.getBBox().height;
        tmp.setAttributeNS(null, "x", tmpx + tileWidthHand - boxw / 2);
        tmp.setAttributeNS(null, "y", tmpy + tileHeightHand / 2 + 15);

        tmpx -= tileWidthHand * 2 + 20;
        if (i == 1) {
            tmpx = optionAreaStartX;
            tmpy = optionAreaStartY - tileHeight - 40;
        }
    }
    
    tmp = document.createElementNS(xmlns, "rect");
    tmp.setAttributeNS(null, "x", middleFrameX - 7 * tileWidth);
    tmp.setAttributeNS(null, "y", middleFrameY - 3 * tileWidth);
    tmp.setAttributeNS(null, "width", tileWidth * 20);
    tmp.setAttributeNS(null, "height", tileWidth * 12);
    tmp.setAttributeNS(null, "fill", "gray");
    svg.appendChild(tmp);

    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = "plaler1  和牌";
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "50");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY - 30);
    
    hand = ['1m', '2m', '3m', '4m', '5m', '6m', '7p', '8p', '9p', '2s', '2s'];
    completed_hand = ['1s1s1s'];
    draw = '5m';
    pattern = ['清', '捉五'];
    score = 6;
    hand.splice(hand.indexOf(draw), 1);

    let tmpTotalLen = hand.length + 1.25;
    for (let i = 0; i < completed_hand.length; i++) {
        tmpTotalLen += completed_hand[i].length / 2 + 0.25;
    }

    let curWinX = w / 2 - tmpTotalLen * tileWidth / 2;
    for (let i = 0; i < completed_hand.length; i++) {
        tmptile = completed_hand[i].slice(0, 2);
        for (let j = 0; j < completed_hand[i].length / 2; j++) {
            tmp = document.createElementNS(xmlns, "image");
            tmp.setAttribute("href", `assets/${tmptile}.jpg`);
            tmp.setAttributeNS(null, "x", curWinX);
            tmp.setAttributeNS(null, "y", middleFrameY + 40);
            tmp.setAttributeNS(null, "width", tileWidth);
            tmp.setAttributeNS(null, "height", tileHeight);
            svg.appendChild(tmp);
            curWinX += tileWidth;
        }
        curWinX += 0.25 * tileWidth;
    }

    for (let i = 0; i < hand.length; i++) {
        tmp = document.createElementNS(xmlns, "image");
        tmp.setAttribute("href", `assets/${hand[i]}.jpg`);
        tmp.setAttributeNS(null, "x", curWinX);
        tmp.setAttributeNS(null, "y", middleFrameY + 40);
        tmp.setAttributeNS(null, "width", tileWidth);
        tmp.setAttributeNS(null, "height", tileHeight);
        svg.appendChild(tmp);
        curWinX += tileWidth;
    }
    curWinX += 0.25 * tileWidth;
    tmp = document.createElementNS(xmlns, "image");
    tmp.setAttribute("href", `assets/${draw}.jpg`);
    tmp.setAttributeNS(null, "x", curWinX);
    tmp.setAttributeNS(null, "y", middleFrameY + 40);
    tmp.setAttributeNS(null, "width", tileWidth);
    tmp.setAttributeNS(null, "height", tileHeight);
    svg.appendChild(tmp);

    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = pattern.join(" ");
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "50");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + 180);

    tmp = document.createElementNS(xmlns, "text");
    tmp.textContent = score + "分";
    tmp.setAttributeNS(null, "x", 0);
    tmp.setAttributeNS(null, "y", 0);
    tmp.setAttributeNS(null, "font-size", "50");
    svg.appendChild(tmp);
    box = tmp.getBBox().width;
    tmp.setAttributeNS(null, "x", w / 2 - box / 2);
    tmp.setAttributeNS(null, "y", middleFrameY + 280);
</script>
</body>
</html>